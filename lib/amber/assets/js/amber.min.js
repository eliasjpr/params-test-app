var Amber=function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i={join:"join",leave:"leave",message:"message"},s=function(){return(new Date).getTime()},c=function(e){return(s()-e)/1e3},a=t.Channel=function(){function e(t,o){n(this,e),this.topic=t,this.socket=o,this.onMessageHandlers=[]}return o(e,[{key:"join",value:function(){this.socket.ws.send(JSON.stringify({event:i.join,topic:this.topic}))}},{key:"leave",value:function(){this.socket.ws.send(JSON.stringify({event:i.leave,topic:this.topic}))}},{key:"handleMessage",value:function(e){this.onMessageHandlers.forEach(function(t){t.subject===e.subject&&t.callback(e.payload)})}},{key:"on",value:function(e,t){this.onMessageHandlers.push({subject:e,callback:t})}},{key:"push",value:function(e,t){this.socket.ws.send(JSON.stringify({event:i.message,topic:this.topic,subject:e,payload:t}))}}]),e}(),r=t.Socket=function(){function e(t){n(this,e),this.endpoint=t,this.ws=null,this.channels=[],this.lastPing=s(),this.reconnectTries=0,this.attemptReconnect=!0}return o(e,[{key:"_connectionIsStale",value:function(){return c(this.lastPing)>100}},{key:"_reconnect",value:function(){var e=this;this.reconnectTimeout=setTimeout(function(){e.reconnectTries++,e.connect(e.params),e._reconnect()},this._reconnectInterval())}},{key:"_reconnectInterval",value:function(){return[1e3,2e3,5e3,1e4][this.reconnectTries]||1e4}},{key:"_poll",value:function(){var e=this;this.pollingTimeout=setTimeout(function(){e._connectionIsStale()?e._reconnect():e._poll()},1e4)}},{key:"_startPolling",value:function(){clearTimeout(this.pollingTimeout),this._poll()}},{key:"_handlePing",value:function(){this.lastPing=s()}},{key:"_reset",value:function(){clearTimeout(this.reconnectTimeout),this.reconnectTries=0,this.attemptReconnect=!0,this._startPolling()}},{key:"connect",value:function(e){var t=this;this.params=e;var n={location:window.location.hostname,port:window.location.port,protocol:"https:"===window.location.protocol?"wss:":"ws:"};return e&&Object.assign(n,e),n.port&&(n.location+=":"+n.port),new Promise(function(e,o){t.ws=new WebSocket(n.protocol+"//"+n.location+t.endpoint),t.ws.onmessage=function(e){t.handleMessage(e)},t.ws.onclose=function(){t.attemptReconnect&&t._reconnect()},t.ws.onopen=function(){t._reset(),e()}})}},{key:"disconnect",value:function(){this.attemptReconnect=!1,clearTimeout(this.pollingTimeout),clearTimeout(this.reconnectTimeout),this.ws.close()}},{key:"channel",value:function(e){var t=new a(e,this);return this.channels.push(t),t}},{key:"handleMessage",value:function(e){if("ping"===e.data)return this._handlePing();parsed_msg=JSON.parse(e.data),this.channels.forEach(function(e){e.topic===parsed_msg.topic&&e.handleMessage(parsed_msg)})}}]),e}();e.exports={Socket:r}}]);